{% extends "base.html" %}
{% load static %}

{% block title %}Home - Sangabiz{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero">
    <div class="container">
        <h1>Discover Your Sound</h1>
        <p>Stream millions of songs, create playlists, and share your favorite tracks with the world.</p>
        <div class="cta-buttons">
            {% if user.is_authenticated %}
            <button class="primary-btn" onclick="startListening()" id="startListeningBtn">
                <i class="fas fa-play"></i>
                Start Listening
            </button>
            {% else %}
            <a href="{% url 'signup' %}" class="primary-btn">
                <i class="fas fa-rocket"></i>
                Get Started Free
            </a>
            <a href="{% url 'login' %}" class="secondary-btn">
                <i class="fas fa-sign-in-alt"></i>
                Login
            </a>
            {% endif %}
        </div>
    </div>
</section>

<!-- Stats Overview -->
<section class="container" style="margin-bottom: 40px;">
    <div class="stats-overview">
        <div class="stat-item">
            <div class="stat-icon">
                <i class="fas fa-music"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-number">{{ total_songs }}</h3>
                <p class="stat-label">Total Songs</p>
            </div>
        </div>
        <div class="stat-item">
            <div class="stat-icon">
                <i class="fas fa-play"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-number">{{ total_plays }}</h3>
                <p class="stat-label">Total Plays</p>
            </div>
        </div>
        <div class="stat-item">
            <div class="stat-icon">
                <i class="fas fa-download"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-number">{{ total_downloads }}</h3>
                <p class="stat-label">Total Downloads</p>
            </div>
        </div>
        <div class="stat-item">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-number">{{ total_artists }}</h3>
                <p class="stat-label">Total Artists</p>
            </div>
        </div>
    </div>
</section>

<!-- Featured Songs - Mdundo Style -->
<section class="container" style="margin-top: 60px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h2 class="section-title">
            <i class="fas fa-fire"></i>
            Featured Songs
        </h2>
        <a href="{% url 'discover' %}" style="color: var(--primary); text-decoration: none; font-weight: 600;">
            View All <i class="fas fa-arrow-right"></i>
        </a>
    </div>
    
    <!-- Mdundo Style Song List -->
    <div class="mdundo-song-list">
        {% for song in featured_songs %}
        <div class="mdundo-song-item" data-song-id="{{ song.id }}" data-plays="{{ song.plays }}" data-downloads="{{ song.downloads }}">
            <div class="song-number">{{ forloop.counter }}</div>
            <div class="song-image" style="background-image: url('{% if song.cover_image %}{{ song.cover_image.url }}{% else %}{% static 'images/default-cover.jpg' %}{% endif %}')"></div>
            <div class="song-info">
                <h4 class="song-title">{{ song.title }}</h4>
                <p class="song-artist">{{ song.artist.name }}</p>
                <div class="song-meta">
                    <span class="song-genre">{{ song.genre.name|default:"No genre" }}</span>
                </div>
            </div>
            
            <!-- Song Stats for PC -->
            <div class="song-stats-pc">
                <div class="stat">
                    <i class="fas fa-play"></i>
                    <span class="plays">{{ song.plays }}</span>
                </div>
                <div class="stat">
                    <i class="fas fa-download"></i>
                    <span class="downloads">{{ song.downloads }}</span>
                </div>
            </div>
            
            <div class="song-actions">
                <div class="song-actions-stats">
                    <div class="song-buttons">
                        <button class="mdundo-play-btn" onclick="playSongFromCard({{ song.id }})" title="Play">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="mdundo-download-btn" onclick="downloadSong({{ song.id }}, this)" title="Download">
                            <i class="fas fa-download"></i>
                        </button>
                        {% if user.is_authenticated %}
                        <button class="mdundo-like-btn" onclick="likeSong({{ song.id }}, this)" title="Like">
                            <i class="far fa-heart"></i>
                        </button>
                        {% endif %}
                    </div>
                    <!-- Mobile Stats Below Buttons -->
                    <div class="song-stats-below">
                        <span class="stat">
                            <i class="fas fa-play"></i>
                            <span class="plays">{{ song.plays }}</span>
                        </span>
                        <span class="stat">
                            <i class="fas fa-download"></i>
                            <span class="downloads">{{ song.downloads }}</span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="no-songs">
            <i class="fas fa-music"></i>
            <p>No featured songs available yet.</p>
            {% if user.is_authenticated and user.is_staff %}
            <a href="/admin/music/song/add/" class="primary-btn">
                <i class="fas fa-plus"></i> Add Songs
            </a>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</section>

<!-- Top Charts - Mdundo Style -->
<section class="container" style="margin-top: 60px;">
    <h2 class="section-title">
        <i class="fas fa-chart-line"></i>
        Top Charts
    </h2>
    
    <div class="charts-grid">
        <!-- Most Played -->
        <div class="chart-section">
            <h3 class="chart-title">
                <i class="fas fa-play" style="color: var(--primary);"></i>
                Most Played
            </h3>
            <div class="mdundo-song-list compact">
                {% for song in most_played %}
                <div class="mdundo-song-item compact" onclick="playSongFromCard({{ song.id }})" data-chart-song-id="{{ song.id }}">
                    <div class="song-number">{{ forloop.counter }}</div>
                    <div class="song-image" style="background-image: url('{% if song.cover_image %}{{ song.cover_image.url }}{% else %}{% static 'images/default-cover.jpg' %}{% endif %}')"></div>
                    <div class="song-info">
                        <h4 class="song-title">{{ song.title }}</h4>
                        <p class="song-artist">{{ song.artist.name }}</p>
                    </div>
                    <div class="song-plays">
                        <i class="fas fa-play"></i>
                        <span class="plays">{{ song.plays }}</span>
                    </div>
                </div>
                {% empty %}
                <div class="no-data">
                    <i class="fas fa-music"></i>
                    <p>No plays yet</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Most Downloaded -->
        <div class="chart-section">
            <h3 class="chart-title">
                <i class="fas fa-download" style="color: var(--secondary);"></i>
                Most Downloaded
            </h3>
            <div class="mdundo-song-list compact">
                {% for song in most_downloaded %}
                <div class="mdundo-song-item compact" onclick="playSongFromCard({{ song.id }})" data-chart-song-id="{{ song.id }}">
                    <div class="song-number">{{ forloop.counter }}</div>
                    <div class="song-image" style="background-image: url('{% if song.cover_image %}{{ song.cover_image.url }}{% else %}{% static 'images/default-cover.jpg' %}{% endif %}')"></div>
                    <div class="song-info">
                        <h4 class="song-title">{{ song.title }}</h4>
                        <p class="song-artist">{{ song.artist.name }}</p>
                    </div>
                    <div class="song-downloads">
                        <i class="fas fa-download"></i>
                        <span class="downloads">{{ song.downloads }}</span>
                    </div>
                </div>
                {% empty %}
                <div class="no-data">
                    <i class="fas fa-music"></i>
                    <p>No downloads yet</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<!-- New Artists Section -->
<section class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h2 class="section-title">
            <i class="fas fa-user-plus"></i>
            New Artists
        </h2>
        <a href="{% url 'artists' %}" style="color: var(--primary); text-decoration: none; font-weight: 600;">
            View All <i class="fas fa-arrow-right"></i>
        </a>
    </div>
    
    <div class="artists-grid">
        {% for artist in new_artists %}
        <div class="artist-card">
            <div class="artist-image">
                {% if artist.image %}
                    <img src="{{ artist.image.url }}" alt="{{ artist.name }}">
                {% else %}
                    <div class="artist-placeholder">
                        <i class="fas fa-user"></i>
                    </div>
                {% endif %}
                {% if artist.is_verified %}
                <div class="verified-badge">
                    <i class="fas fa-check"></i>
                </div>
                {% endif %}
            </div>
            <div class="artist-info">
                <h4 class="artist-name">{{ artist.name }}</h4>
                <p class="artist-genre">{{ artist.genre.name|default:"No genre" }}</p>
                <div class="artist-stats">
                    <span class="stat">
                        <i class="fas fa-music"></i>
                        {{ artist.total_songs }} songs
                    </span>
                    <span class="stat">
                        <i class="fas fa-play"></i>
                        {{ artist.total_plays }} plays
                    </span>
                </div>
                <div class="artist-actions">
                    <button class="follow-btn" onclick="followArtist({{ artist.id }}, this)">
                        <i class="fas fa-plus"></i>
                        Follow
                    </button>
                    <button class="view-btn" onclick="viewArtist({{ artist.id }})">
                        View Profile
                    </button>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="no-artists">
            <i class="fas fa-users"></i>
            <p>No new artists yet</p>
        </div>
        {% endfor %}
    </div>
</section>

<!-- Trending Artists Section -->
<section class="container" style="margin-top: 60px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h2 class="section-title">
            <i class="fas fa-fire"></i>
            Trending Artists
        </h2>
        <a href="{% url 'trending_artists' %}" style="color: var(--primary); text-decoration: none; font-weight: 600;">
            View All <i class="fas fa-arrow-right"></i>
        </a>
    </div>
    
    <div class="artists-grid">
        {% for artist in trending_artists %}
        <div class="artist-card trending">
            <div class="trending-badge">
                <i class="fas fa-fire"></i>
                #{{ forloop.counter }}
            </div>
            <div class="artist-image">
                {% if artist.image %}
                    <img src="{{ artist.image.url }}" alt="{{ artist.name }}">
                {% else %}
                    <div class="artist-placeholder">
                        <i class="fas fa-user"></i>
                    </div>
                {% endif %}
                {% if artist.is_verified %}
                <div class="verified-badge">
                    <i class="fas fa-check"></i>
                </div>
                {% endif %}
            </div>
            <div class="artist-info">
                <h4 class="artist-name">{{ artist.name }}</h4>
                <p class="artist-genre">{{ artist.genre.name|default:"No genre" }}</p>
                <div class="trending-stats">
                    <div class="trend-stat">
                        <i class="fas fa-chart-line"></i>
                        <span>{{ artist.weekly_plays }} plays this week</span>
                    </div>
                    <div class="trend-stat">
                        <i class="fas fa-users"></i>
                        <span>{{ artist.followers_count }} followers</span>
                    </div>
                </div>
                <div class="artist-actions">
                    <button class="follow-btn" onclick="followArtist({{ artist.id }}, this)">
                        <i class="fas fa-plus"></i>
                        Follow
                    </button>
                    <button class="view-btn" onclick="viewArtist({{ artist.id }})">
                        View Profile
                    </button>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="no-artists">
            <i class="fas fa-fire"></i>
            <p>No trending artists yet</p>
        </div>
        {% endfor %}
    </div>
</section>

<!-- Genres Section -->
<section class="container genres-section" style="margin-top: 60px;">
    <h2 class="section-title">
        <i class="fas fa-compass"></i>
        Browse Genres
    </h2>
    <div class="genres-grid">
        {% for genre in genres %}
        <a href="{% url 'genre_songs' genre.id %}" class="genre-link">
            <div class="genre-card" style="background: {{ genre.color|default:'linear-gradient(135deg, #6c5ce7, #fd79a8)' }};">
                <span class="genre-name">{{ genre.name }}</span>
                <div class="genre-count">{{ genre.song_count }} songs</div>
            </div>
        </a>
        {% endfor %}
    </div>
</section>


<!-- Featured YouTube Videos Section with Auto Slider -->
<section class="container" style="margin-top: 60px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h2 class="section-title">
            <i class="fas fa-video"></i>
            Featured Videos
        </h2>
        <a href="{% url 'discover' %}" style="color: var(--primary); text-decoration: none; font-weight: 600;">
            View All <i class="fas fa-arrow-right"></i>
        </a>
    </div>
    
    <div class="videos-slider-container">
        <div class="videos-slider" id="videos-slider">
            {% for video in featured_videos %}
            <div class="video-slide">
                <div class="video-card">
                    <div class="video-thumbnail">
                        <img src="{{ video.thumbnail_url }}" alt="{{ video.title }}" onerror="this.src='{% static 'images/default-video.jpg' %}'">
                        <div class="play-overlay" onclick="playYouTubeVideo('{{ video.youtube_id }}')">
                            <i class="fas fa-play"></i>
                        </div>
                        <div class="video-duration">{{ video.duration }}</div>
                    </div>
                    <div class="video-info">
                        <h3 class="video-title">{{ video.title }}</h3>
                        <p class="video-description">{{ video.description|truncatewords:15 }}</p>
                        <div class="video-meta">
                            <span class="video-views">
                                <i class="fas fa-eye"></i>
                                {{ video.views }} views
                            </span>
                            <span class="video-date">{{ video.published_date|date:"M d, Y" }}</span>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="no-content">
                <i class="fas fa-video"></i>
                <p>No featured videos available</p>
            </div>
            {% endfor %}
        </div>
        
        <!-- Slider Controls -->
        <button class="slider-nav prev" id="videos-prev">
            <i class="fas fa-chevron-left"></i>
        </button>
        <button class="slider-nav next" id="videos-next">
            <i class="fas fa-chevron-right"></i>
        </button>
        
        <!-- Slider Dots -->
        <div class="slider-dots" id="videos-dots"></div>
    </div>
</section>

<!-- Latest News Section with Auto Slider -->
<section class="container" style="margin-top: 60px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h2 class="section-title">
            <i class="fas fa-newspaper"></i>
            Latest Music News
        </h2>
        <a href="{% url 'news' %}" style="color: var(--primary); text-decoration: none; font-weight: 600;">
            View All <i class="fas fa-arrow-right"></i>
        </a>
    </div>
    
    <div class="news-slider-container">
        <div class="news-slider" id="news-slider">
            {% for article in latest_news %}
            <div class="news-slide">
                <div class="news-card">
                    {% if article.featured_image %}
                    <div class="news-image">
                        <img src="{{ article.featured_image.url }}" alt="{{ article.title }}">
                        <div class="news-overlay"></div>
                    </div>
                    {% endif %}
                    <div class="news-content">
                        <span class="news-category {{ article.category|lower }}">{{ article.get_category_display }}</span>
                        <h3 class="news-title">{{ article.title }}</h3>
                        <p class="news-excerpt">{{ article.excerpt|truncatewords:20 }}</p>
                        <div class="news-meta">
                            <span class="news-date">
                                <i class="far fa-clock"></i>
                                {{ article.published_date|date:"M d, Y" }}
                            </span>
                            <span class="news-author">
                                <i class="far fa-user"></i>
                                {{ article.author }}
                            </span>
                        </div>
                        <a href="{% url 'news_detail' article.slug %}" class="read-more">
                            Read More <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="no-content">
                <i class="fas fa-newspaper"></i>
                <p>No news articles available</p>
            </div>
            {% endfor %}
        </div>
        
        <!-- Slider Controls -->
        <button class="slider-nav prev" id="news-prev">
            <i class="fas fa-chevron-left"></i>
        </button>
        <button class="slider-nav next" id="news-next">
            <i class="fas fa-chevron-right"></i>
        </button>
        
        <!-- Slider Dots -->
        <div class="slider-dots" id="news-dots"></div>
    </div>
</section>



<!-- YouTube Video Modal -->
<div class="video-modal" id="video-modal">
    <div class="video-modal-content">
        <button class="close-modal" id="close-video-modal">
            <i class="fas fa-times"></i>
        </button>
        <div class="video-container">
            <iframe id="youtube-player" width="100%" height="400" 
                    src="" frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
            </iframe>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* ===== HERO SECTION ===== */
.hero {
    background: linear-gradient(135deg, 
                rgba(108, 92, 231, 0.85), 
                rgba(168, 180, 3, 0.85)),
                url('{% static "images/hero-bg.jpg" %}') center/cover no-repeat;
    padding: 120px 0;
    text-align: center;
    color: white;
    position: relative;
    overflow: hidden;
}

.hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('{% static "images/hero-bg.jpg" %}') repeat;
    opacity: 0.1;
    animation: float 20s infinite linear;
}

@keyframes float {
    0% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(180deg); }
    100% { transform: translateY(0px) rotate(360deg); }
}

.hero .container {
    position: relative;
    z-index: 2;
}

.hero h1 {
    font-size: 3.5rem;
    margin-bottom: 20px;
    font-weight: 800;
    text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
    background: linear-gradient(45deg, #fff, #e0e0e0);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.hero p {
    font-size: 1.3rem;
    margin-bottom: 40px;
    opacity: 0.95;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
    font-weight: 300;
    line-height: 1.6;
}

.cta-buttons {
    display: flex;
    gap: 20px;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
}

.primary-btn, .secondary-btn {
    padding: 15px 35px;
    border-radius: 50px;
    font-size: 1.1rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
}

.primary-btn {
    background: linear-gradient(135deg, var(--primary), #5f27cd);
    color: white;
}

.primary-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(108, 92, 231, 0.4);
}

.secondary-btn {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 255, 255, 0.3);
}

.secondary-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(255, 255, 255, 0.2);
}

/* ===== STATS OVERVIEW ===== */
.stats-overview {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-top: 20px;
}

.stat-item {
    background: var(--card-bg);
    padding: 20px;
    border-radius: 15px;
    text-align: center;
    border: 1px solid rgba(255,255,255,0.1);
    transition: var(--transition);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 120px;
}

.stat-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

.stat-icon {
    font-size: 32px;
    margin-bottom: 10px;
}

.stat-icon i {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.stat-content {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.stat-number {
    color: var(--light);
    margin-bottom: 5px;
    font-size: 1.8rem;
    font-weight: 700;
}

.stat-label {
    color: var(--gray);
    margin: 0;
    font-size: 0.9rem;
    font-weight: 500;
}

/* ===== SLIDER STYLES ===== */
.videos-slider-container,
.news-slider-container {
    position: relative;
    margin: 0 -10px;
    padding: 0 10px;
}

.videos-slider,
.news-slider {
    display: flex;
    overflow-x: auto;
    scroll-behavior: smooth;
    scrollbar-width: none;
    -ms-overflow-style: none;
    gap: 20px;
    padding: 10px 0;
    scroll-snap-type: x mandatory;
}

.videos-slider::-webkit-scrollbar,
.news-slider::-webkit-scrollbar {
    display: none;
}

.video-slide,
.news-slide {
    flex: 0 0 calc(100% - 40px);
    scroll-snap-align: start;
    min-width: 0;
}

/* Slider Navigation */
.slider-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.7);
    border: none;
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.slider-nav:hover {
    background: rgba(0, 0, 0, 0.9);
    transform: translateY(-50%) scale(1.1);
}

.slider-nav.prev {
    left: 5px;
}

.slider-nav.next {
    right: 5px;
}

.slider-nav:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    transform: translateY(-50%) scale(1);
}

/* Slider Dots */
.slider-dots {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 20px;
}

.slider-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
}

.slider-dot.active {
    background: var(--primary);
    transform: scale(1.2);
}

/* ===== ENHANCED VIDEO CARD STYLES ===== */
.video-card {
    background: var(--card-bg);
    border-radius: 16px;
    overflow: hidden;
    transition: var(--transition);
    border: 1px solid rgba(255, 255, 255, 0.1);
    height: 100%;
    display: flex;
    flex-direction: column;
}

.video-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
}

.video-thumbnail {
    position: relative;
    width: 100%;
    height: 200px;
    overflow: hidden;
}

.video-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.video-card:hover .video-thumbnail img {
    transform: scale(1.05);
}

.play-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: var(--transition);
    cursor: pointer;
}

.video-thumbnail:hover .play-overlay {
    opacity: 1;
}

.play-overlay i {
    font-size: 48px;
    color: var(--light);
    transition: transform 0.3s ease;
}

.play-overlay:hover i {
    transform: scale(1.1);
}

.video-duration {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
}

.video-info {
    padding: 20px;
    flex: 1;
    display: flex;
    flex-direction: column;
}

.video-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--light);
    margin-bottom: 8px;
    line-height: 1.3;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.video-description {
    font-size: 14px;
    color: var(--gray);
    line-height: 1.4;
    margin-bottom: 12px;
    flex: 1;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.video-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
    color: var(--dark-gray);
}

.video-views {
    display: flex;
    align-items: center;
    gap: 4px;
}

.video-views i {
    color: var(--primary);
}

/* ===== ENHANCED NEWS CARD STYLES ===== */
.news-card {
    background: var(--card-bg);
    border-radius: 16px;
    overflow: hidden;
    transition: var(--transition);
    border: 1px solid rgba(255, 255, 255, 0.1);
    height: 100%;
    display: flex;
    flex-direction: column;
}

.news-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
}

.news-image {
    position: relative;
    width: 100%;
    height: 200px;
    overflow: hidden;
}

.news-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.news-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.8));
    opacity: 0;
    transition: var(--transition);
}

.news-card:hover .news-image img {
    transform: scale(1.05);
}

.news-card:hover .news-overlay {
    opacity: 1;
}

.news-content {
    padding: 20px;
    flex: 1;
    display: flex;
    flex-direction: column;
}

.news-category {
    display: inline-block;
    padding: 6px 12px;
    background: var(--primary);
    color: var(--dark);
    border-radius: 20px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 12px;
    align-self: flex-start;
}

.news-category.breaking {
    background: #e74c3c;
}

.news-category.trending {
    background: #f39c12;
}

.news-category.exclusive {
    background: #9b59b6;
}

.news-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--light);
    margin-bottom: 10px;
    line-height: 1.3;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.news-excerpt {
    font-size: 14px;
    color: var(--gray);
    line-height: 1.5;
    margin-bottom: 15px;
    flex: 1;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.news-meta {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
    font-size: 12px;
    color: var(--dark-gray);
}

.news-date,
.news-author {
    display: flex;
    align-items: center;
    gap: 4px;
}

.news-date i,
.news-author i {
    font-size: 10px;
}

.read-more {
    color: var(--primary);
    text-decoration: none;
    font-weight: 600;
    font-size: 14px;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 6px;
    align-self: flex-start;
}

.read-more:hover {
    color: var(--primary-dark);
    gap: 8px;
}

/* ===== SONG STYLES ===== */
.mdundo-song-list {
    background: var(--card-bg);
    border-radius: 15px;
    border: 1px solid rgba(255,255,255,0.1);
    overflow: hidden;
}

.mdundo-song-list.compact {
    background: transparent;
    border: none;
}

.mdundo-song-item {
    display: flex;
    align-items: center;
    padding: 15px 20px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    transition: var(--transition);
    cursor: pointer;
}

.mdundo-song-item:last-child {
    border-bottom: none;
}

.mdundo-song-item:hover {
    background: rgba(255,255,255,0.05);
}

.mdundo-song-item.compact {
    padding: 12px 15px;
    background: var(--card-bg);
    border-radius: 10px;
    margin-bottom: 8px;
    border: 1px solid rgba(255,255,255,0.1);
}

.mdundo-song-item.compact:last-child {
    margin-bottom: 0;
}

.song-number {
    font-weight: bold;
    color: var(--primary);
    min-width: 30px;
    font-size: 16px;
    text-align: center;
}

.song-image {
    width: 50px;
    height: 50px;
    border-radius: 8px;
    background-size: cover;
    background-position: center;
    margin: 0 15px;
    flex-shrink: 0;
}

.song-image.small {
    width: 40px;
    height: 40px;
    margin: 0 12px 0 0;
}

.song-info {
    flex: 1;
    min-width: 0;
}

.song-title {
    font-size: 16px;
    font-weight: 600;
    margin: 0 0 4px 0;
    color: var(--light);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.song-artist {
    font-size: 14px;
    color: var(--gray);
    margin: 0 0 4px 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.song-meta {
    display: flex;
    gap: 12px;
    margin-top: 4px;
}

.song-genre,
.song-duration {
    font-size: 12px;
    color: var(--dark-gray);
    background: rgba(255,255,255,0.1);
    padding: 2px 8px;
    border-radius: 10px;
}

/* PC Stats */
.song-stats-pc {
    display: flex;
    gap: 20px;
    margin: 0 20px;
}

.song-stats-pc .stat {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: var(--gray);
    font-weight: 500;
}

.song-stats-pc .stat i {
    font-size: 12px;
    color: var(--primary);
}

.song-actions {
    display: flex;
    gap: 8px;
    align-items: center;
}

.song-actions-stats {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}

.song-buttons {
    display: flex;
    gap: 8px;
    align-items: center;
}

/* Mdundo Style Buttons */
.mdundo-play-btn {
    background: linear-gradient(135deg, var(--primary), #5f27cd);
    color: white;
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
    font-size: 16px;
    box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
}

.mdundo-play-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(108, 92, 231, 0.4);
}

.mdundo-play-btn.small {
    width: 36px;
    height: 36px;
    font-size: 14px;
}

.mdundo-download-btn {
    background: linear-gradient(135deg, var(--secondary), #e84393);
    color: white;
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
    font-size: 16px;
    box-shadow: 0 4px 15px rgba(253, 121, 168, 0.3);
}

.mdundo-download-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(253, 121, 168, 0.4);
}

.mdundo-like-btn {
    background: rgba(255,255,255,0.1);
    color: var(--gray);
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
    font-size: 16px;
}

.mdundo-like-btn:hover {
    color: var(--secondary);
    background: rgba(253, 121, 168, 0.1);
}

/* Mobile Stats Below Buttons */
.song-stats-below {
    display: none;
    gap: 12px;
    font-size: 10px;
    color: var(--gray);
    opacity: 0.8;
}

.song-stats-below .stat {
    display: flex;
    align-items: center;
    gap: 3px;
    white-space: nowrap;
}

.song-stats-below i {
    font-size: 9px;
}

/* ===== CHARTS STYLES ===== */
.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
}

.chart-section {
    background: var(--card-bg);
    border-radius: 15px;
    padding: 20px;
    border: 1px solid rgba(255,255,255,0.1);
}

.chart-title {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
    font-size: 18px;
    color: var(--light);
}

.song-plays, .song-downloads {
    display: flex;
    align-items: center;
    gap: 5px;
    color: var(--gray);
    font-size: 14px;
    margin-left: auto;
    padding-left: 15px;
}

/* ===== ARTISTS GRID ===== */
.artists-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
    margin-top: 20px;
}

.artist-card {
    background: var(--card-bg);
    border-radius: 20px;
    padding: 25px;
    border: 1px solid rgba(255,255,255,0.1);
    transition: var(--transition);
    position: relative;
    text-align: center;
}

.artist-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.3);
}

.artist-card.trending {
    border: 2px solid var(--secondary);
    background: linear-gradient(135deg, var(--card-bg), rgba(253, 121, 168, 0.1));
}

.trending-badge {
    position: absolute;
    top: 15px;
    right: 15px;
    background: linear-gradient(135deg, var(--secondary), #e84393);
    color: white;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 5px;
}

.artist-image {
    width: 100px;
    height: 100px;
    margin: 0 auto 20px;
    position: relative;
}

.artist-image img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid rgba(255,255,255,0.2);
}

.artist-placeholder {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    color: white;
    border: 3px solid rgba(255,255,255,0.2);
}

.verified-badge {
    position: absolute;
    bottom: 5px;
    right: 5px;
    background: var(--primary);
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    color: white;
    border: 2px solid var(--card-bg);
}

.artist-info {
    text-align: center;
}

.artist-name {
    font-size: 1.3rem;
    font-weight: 700;
    margin: 0 0 8px 0;
    color: var(--light);
}

.artist-genre {
    color: var(--primary);
    font-size: 0.9rem;
    margin: 0 0 15px 0;
    font-weight: 500;
}

.artist-stats {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 15px 0;
}

.artist-stats .stat {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.85rem;
    color: var(--gray);
}

.trending-stats {
    margin: 15px 0;
}

.trend-stat {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    color: var(--gray);
    margin: 8px 0;
    justify-content: center;
}

.trend-stat i {
    color: var(--secondary);
}

.artist-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 20px;
}

.follow-btn, .view-btn {
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    border: none;
}

.follow-btn {
    background: var(--primary);
    color: white;
    display: flex;
    align-items: center;
    gap: 5px;
}

.follow-btn:hover {
    background: #5649c0;
    transform: translateY(-2px);
}

.follow-btn.following {
    background: var(--secondary);
}

.view-btn {
    background: rgba(255,255,255,0.1);
    color: var(--light);
    border: 1px solid rgba(255,255,255,0.2);
}

.view-btn:hover {
    background: rgba(255,255,255,0.2);
    transform: translateY(-2px);
}

/* ===== GENRES STYLES ===== */
.genres-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.genre-link {
    text-decoration: none;
}

.genre-card {
    position: relative;
    padding: 25px 20px;
    border-radius: 12px;
    color: white;
    text-align: center;
    transition: var(--transition);
    min-height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
}

.genre-card:hover {
    transform: translateY(-5px);
}

.genre-name {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 5px;
}

.genre-count {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(0,0,0,0.7);
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 12px;
}

/* ===== NO CONTENT STATES ===== */
.no-artists,
.no-songs,
.no-data,
.no-content {
    text-align: center;
    padding: 40px 20px;
    color: var(--gray);
    grid-column: 1 / -1;
}

.no-artists i,
.no-songs i,
.no-data i,
.no-content i {
    font-size: 48px;
    margin-bottom: 15px;
    opacity: 0.5;
}

/* ===== VIDEO MODAL STYLES ===== */
.video-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 3000;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.video-modal-content {
    position: relative;
    width: 100%;
    max-width: 800px;
    background: var(--card-bg);
    border-radius: 12px;
    overflow: hidden;
}

.close-modal {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(0, 0, 0, 0.7);
    border: none;
    color: var(--light);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10;
    transition: var(--transition);
}

.close-modal:hover {
    background: rgba(0, 0, 0, 0.9);
    transform: scale(1.1);
}

.video-container {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%;
    height: 0;
}

.video-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

/* ===== MOBILE STYLES ===== */
@media (max-width: 768px) {
    /* Base adjustments */
    html {
        font-size: 16px;
    }
    
    .container {
        padding-left: 15px;
        padding-right: 15px;
    }
    
    /* Hero section */
    .hero {
        padding: 60px 0;
    }
    
    .hero h1 {
        font-size: 2.2rem;
        margin-bottom: 15px;
    }
    
    .hero p {
        font-size: 1.1rem;
        margin-bottom: 30px;
        padding: 0 10px;
    }
    
    .cta-buttons {
        flex-direction: column;
        gap: 12px;
    }
    
    .primary-btn, .secondary-btn {
        width: 100%;
        max-width: 280px;
        padding: 14px 30px;
        font-size: 1.1rem;
    }
    
    /* Section titles */
    .section-title {
        font-size: 1.5rem;
        margin-bottom: 20px;
    }
    
    /* Stats Overview */
    .stats-overview {
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        margin-top: 15px;
    }
    
    .stat-item {
        padding: 15px 10px;
        min-height: 100px;
    }
    
    .stat-icon {
        font-size: 24px;
        margin-bottom: 8px;
    }
    
    .stat-number {
        font-size: 1.4rem;
        margin-bottom: 3px;
    }
    
    .stat-label {
        font-size: 0.8rem;
    }
    
    /* Slider adjustments */
    .videos-slider-container,
    .news-slider-container {
        margin: 0 -15px;
        padding: 0 15px;
    }

    .video-slide,
    .news-slide {
        flex: 0 0 calc(100% - 30px);
    }

    .video-thumbnail,
    .news-image {
        height: 180px;
    }

    .video-info,
    .news-content {
        padding: 16px;
    }

    .video-title,
    .news-title {
        font-size: 16px;
    }

    .video-description,
    .news-excerpt {
        font-size: 13px;
    }

    .slider-nav {
        width: 35px;
        height: 35px;
    }

    .slider-nav.prev {
        left: 0;
    }

    .slider-nav.next {
        right: 0;
    }
    
    /* Song items */
    .mdundo-song-item {
        padding: 12px 15px;
    }
    
    .mdundo-song-item.compact {
        padding: 10px 12px;
    }
    
    .song-number {
        font-size: 14px;
        min-width: 25px;
    }
    
    .song-image {
        width: 45px;
        height: 45px;
        margin: 0 12px;
    }
    
    .song-image.small {
        width: 35px;
        height: 35px;
        margin: 0 10px 0 0;
    }
    
    .song-title {
        font-size: 1rem;
    }
    
    .song-artist {
        font-size: 0.9rem;
    }
    
    /* Hide PC stats on mobile */
    .song-stats-pc {
        display: none !important;
    }
    
    /* Show stats below buttons on mobile */
    .song-stats-below {
        display: flex !important;
        gap: 12px;
        font-size: 0.8rem;
        color: var(--gray);
        opacity: 0.8;
        margin-top: 5px;
    }
    
    .song-stats-below .stat {
        display: flex;
        align-items: center;
        gap: 4px;
        white-space: nowrap;
    }
    
    .song-stats-below i {
        font-size: 0.7rem;
    }
    
    /* Song buttons */
    .mdundo-play-btn, 
    .mdundo-download-btn, 
    .mdundo-like-btn {
        width: 36px;
        height: 36px;
        font-size: 12px;
    }
    
    .mdundo-play-btn.small {
        width: 32px;
        height: 32px;
        font-size: 12px;
    }
    
    .song-buttons {
        gap: 6px;
    }
    
    /* Charts */
    .charts-grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .chart-section {
        padding: 15px;
    }
    
    .chart-title {
        font-size: 1.2rem;
        margin-bottom: 15px;
    }
    
    .song-plays, .song-downloads {
        font-size: 0.8rem;
        padding-left: 10px;
    }
    
    /* Artists */
    .artists-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }
    
    .artist-card {
        padding: 15px 12px;
        border-radius: 15px;
        min-height: 280px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    
    .artist-image {
        width: 70px;
        height: 70px;
        margin-bottom: 12px;
    }
    
    .artist-placeholder {
        font-size: 1.8rem;
    }
    
    .artist-name {
        font-size: 1rem;
        margin-bottom: 5px;
        line-height: 1.2;
    }
    
    .artist-genre {
        font-size: 0.8rem;
        margin-bottom: 10px;
    }
    
    .artist-stats {
        gap: 8px;
        margin: 10px 0;
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .artist-stats .stat {
        font-size: 0.75rem;
        gap: 3px;
        flex: 1;
        min-width: 80px;
        justify-content: center;
    }
    
    .trending-stats {
        margin: 8px 0;
    }
    
    .trend-stat {
        font-size: 0.75rem;
        gap: 4px;
        margin: 4px 0;
    }
    
    .artist-actions {
        flex-direction: column;
        gap: 6px;
        margin-top: 12px;
    }
    
    .follow-btn, .view-btn {
        width: 100%;
        justify-content: center;
        padding: 6px 10px;
        font-size: 0.8rem;
    }
    
    .trending-badge {
        top: 8px;
        right: 8px;
        font-size: 10px;
        padding: 3px 6px;
    }
    
    /* Genres */
    .genres-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
    }
    
    .genre-card {
        padding: 20px 15px;
        min-height: 80px;
    }
    
    .genre-name {
        font-size: 1rem;
    }
    
    .genre-count {
        font-size: 0.7rem;
        bottom: 8px;
        right: 8px;
    }
    
    /* No content states */
    .no-artists, 
    .no-songs, 
    .no-data,
    .no-content {
        padding: 30px 15px;
    }
    
    .no-artists i, 
    .no-songs i, 
    .no-data i,
    .no-content i {
        font-size: 36px;
    }
    
    /* Activity time */
    .activity-time {
        font-size: 0.75rem;
    }
    
    /* Video Modal */
    .video-modal {
        padding: 10px;
    }
    
    .video-modal-content {
        margin: 20px;
    }
}

/* ===== SMALL MOBILE STYLES ===== */
@media (max-width: 480px) {
    html {
        font-size: 15px;
    }
    
    .hero h1 {
        font-size: 1.8rem;
    }
    
    .hero p {
        font-size: 1rem;
    }
    
    /* Stats Overview */
    .stats-overview {
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
    }
    
    .stat-item {
        padding: 12px 8px;
        min-height: 90px;
    }
    
    .stat-icon {
        font-size: 20px;
        margin-bottom: 6px;
    }
    
    .stat-number {
        font-size: 1.2rem;
    }
    
    .stat-label {
        font-size: 0.75rem;
    }
    
    /* Videos Grid */
    .videos-grid {
        grid-template-columns: 1fr;
    }
    
    .video-thumbnail {
        height: 140px;
    }
    
    /* Artists */
    .artists-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
    
    .artist-card {
        padding: 12px 8px;
        min-height: 260px;
    }
    
    .artist-image {
        width: 60px;
        height: 60px;
        margin-bottom: 10px;
    }
    
    .artist-placeholder {
        font-size: 1.5rem;
    }
    
    .artist-name {
        font-size: 0.9rem;
    }
    
    .artist-genre {
        font-size: 0.75rem;
    }
    
    .artist-stats .stat {
        font-size: 0.7rem;
        min-width: 70px;
    }
    
    .follow-btn, .view-btn {
        font-size: 0.75rem;
        padding: 5px 8px;
    }
    
    .genres-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .section-title {
        font-size: 1.3rem;
    }
    
    .mdundo-song-item {
        padding: 10px 12px;
    }
    
    .song-image {
        width: 40px;
        height: 40px;
        margin: 0 10px;
    }
}

/* ===== EXTRA SMALL MOBILE STYLES ===== */
@media (max-width: 360px) {
    /* Stats Overview */
    .stats-overview {
        grid-template-columns: repeat(4, 1fr);
        gap: 6px;
    }
    
    .stat-item {
        padding: 10px 6px;
        min-height: 85px;
    }
    
    .stat-icon {
        font-size: 18px;
    }
    
    .stat-number {
        font-size: 1.1rem;
    }
    
    .stat-label {
        font-size: 0.7rem;
    }
    
    .artists-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
    }
    
    .artist-card {
        padding: 10px 6px;
        min-height: 240px;
    }
    
    .artist-image {
        width: 50px;
        height: 50px;
    }
    
    .artist-name {
        font-size: 0.85rem;
    }
    
    .artist-stats .stat {
        font-size: 0.65rem;
        min-width: 65px;
    }
    
    .follow-btn, .view-btn {
        font-size: 0.7rem;
    }
}

/* ===== DESKTOP SLIDER STYLES ===== */
@media (min-width: 769px) {
    .videos-slider,
    .news-slider {
        overflow: hidden;
        flex-wrap: wrap;
        justify-content: center;
        gap: 25px;
        padding: 0;
    }

    .video-slide,
    .news-slide {
        flex: 0 0 calc(33.333% - 25px);
        scroll-snap-align: none;
    }

    .slider-nav,
    .slider-dots {
        display: none;
    }

    .videos-slider-container,
    .news-slider-container {
        margin: 0;
        padding: 0;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Enhanced JavaScript for auto-sliding and play counting
document.addEventListener('DOMContentLoaded', function() {
    initializeHomePlaylist();
    setupMobileStats();
    setupVideoModal();
    initializeSliders();
    startAutoSliders();
    setupPlayCounting(); // Initialize play counting
});

// Initialize play counting system
function setupPlayCounting() {
    console.log(' Play counting system initialized');
    
    // Add click listeners to all play buttons
    document.querySelectorAll('.play-btn, .play-btn-card, .track-card, .music-card').forEach(element => {
        element.addEventListener('click', function(e) {
            // Don't count if it's a child button click (like download/like)
            if (e.target.closest('.download-btn, .like-btn, .follow-btn')) {
                return;
            }
            
            const songId = this.closest('[data-song-id]')?.dataset.songId;
            if (songId) {
                console.log(' Play button clicked for song:', songId);
                playSongFromCard(parseInt(songId));
            }
        });
    });
}

// Initialize sliders for videos and news
function initializeSliders() {
    // Videos Slider
    const videosSlider = document.getElementById('videos-slider');
    const videosPrev = document.getElementById('videos-prev');
    const videosNext = document.getElementById('videos-next');
    const videosDots = document.getElementById('videos-dots');
    
    if (videosSlider && videosSlider.querySelectorAll('.video-slide').length > 1) {
        createSlider(videosSlider, videosPrev, videosNext, videosDots);
    } else {
        if (videosPrev) videosPrev.style.display = 'none';
        if (videosNext) videosNext.style.display = 'none';
        if (videosDots) videosDots.style.display = 'none';
    }
    
    // News Slider
    const newsSlider = document.getElementById('news-slider');
    const newsPrev = document.getElementById('news-prev');
    const newsNext = document.getElementById('news-next');
    const newsDots = document.getElementById('news-dots');
    
    if (newsSlider && newsSlider.querySelectorAll('.news-slide').length > 1) {
        createSlider(newsSlider, newsPrev, newsNext, newsDots);
    } else {
        if (newsPrev) newsPrev.style.display = 'none';
        if (newsNext) newsNext.style.display = 'none';
        if (newsDots) newsDots.style.display = 'none';
    }
}

// Create slider with navigation
function createSlider(slider, prevBtn, nextBtn, dotsContainer) {
    const slides = slider.querySelectorAll('.video-slide, .news-slide');
    const slideCount = slides.length;
    let currentSlide = 0;
    let autoSlideInterval;
    
    if (dotsContainer && slideCount > 1) {
        dotsContainer.innerHTML = '';
        for (let i = 0; i < slideCount; i++) {
            const dot = document.createElement('div');
            dot.className = 'slider-dot' + (i === 0 ? ' active' : '');
            dot.addEventListener('click', () => goToSlide(i));
            dotsContainer.appendChild(dot);
        }
    }
    
    function goToSlide(index) {
        if (index < 0) index = slideCount - 1;
        if (index >= slideCount) index = 0;
        
        currentSlide = index;
        slider.scrollTo({
            left: slides[index].offsetLeft - slider.offsetLeft,
            behavior: 'smooth'
        });
        
        updateDots();
        updateNavButtons();
    }
    
    function nextSlide() {
        goToSlide(currentSlide + 1);
    }
    
    function prevSlide() {
        goToSlide(currentSlide - 1);
    }
    
    function updateDots() {
        if (dotsContainer) {
            const dots = dotsContainer.querySelectorAll('.slider-dot');
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentSlide);
            });
        }
    }
    
    function updateNavButtons() {
        if (prevBtn) prevBtn.disabled = slideCount <= 1;
        if (nextBtn) nextBtn.disabled = slideCount <= 1;
    }
    
    function startAutoSlide() {
        stopAutoSlide();
        autoSlideInterval = setInterval(nextSlide, 5000);
    }
    
    function stopAutoSlide() {
        if (autoSlideInterval) {
            clearInterval(autoSlideInterval);
        }
    }
    
    if (prevBtn) prevBtn.addEventListener('click', () => {
        prevSlide();
        stopAutoSlide();
        startAutoSlide();
    });
    
    if (nextBtn) nextBtn.addEventListener('click', () => {
        nextSlide();
        stopAutoSlide();
        startAutoSlide();
    });
    
    // Touch/swipe support
    let startX = 0;
    let isDragging = false;
    
    slider.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        isDragging = true;
        stopAutoSlide();
    });
    
    slider.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        e.preventDefault();
    });
    
    slider.addEventListener('touchend', (e) => {
        if (!isDragging) return;
        
        const endX = e.changedTouches[0].clientX;
        const diff = startX - endX;
        
        if (Math.abs(diff) > 50) {
            if (diff > 0) {
                nextSlide();
            } else {
                prevSlide();
            }
        }
        
        isDragging = false;
        startAutoSlide();
    });
    
    slider.addEventListener('mouseenter', stopAutoSlide);
    slider.addEventListener('mouseleave', startAutoSlide);
    
    updateNavButtons();
    startAutoSlide();
    
    return { nextSlide, prevSlide, goToSlide, startAutoSlide, stopAutoSlide };
}

// Auto-slide functionality
let sliderInstances = [];

function startAutoSliders() {
    sliderInstances.forEach(instance => {
        if (instance && typeof instance.startAutoSlide === 'function') {
            instance.startAutoSlide();
        }
    });
}

function stopAutoSliders() {
    sliderInstances.forEach(instance => {
        if (instance && typeof instance.stopAutoSlide === 'function') {
            instance.stopAutoSlide();
        }
    });
}

// Setup YouTube video modal
function setupVideoModal() {
    const closeModalBtn = document.getElementById('close-video-modal');
    const videoModal = document.getElementById('video-modal');
    
    if (closeModalBtn) {
        closeModalBtn.addEventListener('click', closeVideoModal);
    }
    
    if (videoModal) {
        videoModal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeVideoModal();
            }
        });
    }
    
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeVideoModal();
        }
    });
}

// YouTube Video Player
function playYouTubeVideo(videoId) {
    const modal = document.getElementById('video-modal');
    const iframe = document.getElementById('youtube-player');
    
    iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
    modal.style.display = 'flex';
    stopAutoSliders();
}

function closeVideoModal() {
    const modal = document.getElementById('video-modal');
    const iframe = document.getElementById('youtube-player');
    
    iframe.src = '';
    modal.style.display = 'none';
    startAutoSliders();
}

// Initialize playlist with home page songs
function initializeHomePlaylist() {
    const homeSongs = [
        {% for song in featured_songs %}
        {
            id: {{ song.id }},
            title: "{{ song.title|escapejs }}",
            artist: "{{ song.artist.name|escapejs }}",
            audio: "{{ song.audio_file.url }}",
            cover: "{% if song.cover_image %}{{ song.cover_image.url }}{% else %}{% static 'images/default-cover.jpg' %}{% endif %}",
            duration: {{ song.duration }},
            plays: {{ song.plays }},
            downloads: {{ song.downloads }},
            genre: "{{ song.genre.name|escapejs }}"
        },
        {% endfor %}
    ];
    
    window.homePlaylist = homeSongs;
    console.log(' Home playlist initialized with', homeSongs.length, 'songs');
}

// Start listening using base.html player
function startListening() {
    if (window.homePlaylist && window.homePlaylist.length > 0) {
        if (typeof window.playSong === 'function') {
            window.playSong(window.homePlaylist[0], window.homePlaylist, 0);
        }
    }
}

// ===== FIXED PLAY COUNTING SYSTEM =====
function playSongFromCard(songId) {
    console.log(' Playing song from card:', songId);
    
    // First, track the play count
    trackSongPlay(songId)
        .then(data => {
            if (data.success) {
                console.log(' Play count tracked successfully:', data.play_count);
                updatePlayCountUI(songId, data.play_count);
            } else {
                console.error(' Play tracking failed:', data.error);
            }
        })
        .catch(error => {
            console.error(' Play tracking error:', error);
        });
    
    // Then play the song using base player
    const song = window.homePlaylist?.find(s => s.id === songId);
    
    if (song && typeof window.playSong === 'function') {
        window.playSong(song, window.homePlaylist, window.homePlaylist.findIndex(s => s.id === songId));
        showNotification(`Now playing: ${song.title}`, 'success');
    } else {
        console.error('Song not found or player not available');
        showNotification('Error playing song', 'error');
    }
}

// FIXED: Proper play tracking function
function trackSongPlay(songId) {
    console.log(' Tracking play for song:', songId);
    
    return fetch('/api/track-play/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({
            song_id: songId,
            timestamp: new Date().toISOString(),
            duration_played: 0,
            user_agent: navigator.userAgent,
            source: 'home_page'
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        console.log(' Play tracking response:', data);
        return data;
    })
    .catch(error => {
        console.error(' Play tracking failed:', error);
        throw error;
    });
}

// Enhanced UI update for play counts
function updatePlayCountUI(songId, newPlayCount = null) {
    console.log(' Updating UI for song:', songId, 'New count:', newPlayCount);
    
    // Update all play count elements for this song
    const playElements = document.querySelectorAll(`[data-song-id="${songId}"] .plays, [data-song-id="${songId}"] .play-count`);
    
    playElements.forEach(element => {
        if (newPlayCount !== null) {
            // Use the count from server
            element.textContent = newPlayCount;
        } else {
            // Increment locally
            const currentCount = parseInt(element.textContent) || 0;
            element.textContent = currentCount + 1;
        }
        
        // Add animation effect
        element.style.transform = 'scale(1.2)';
        element.style.color = 'var(--primary)';
        setTimeout(() => {
            element.style.transform = 'scale(1)';
            element.style.color = '';
        }, 300);
    });
    
    // Update data attributes
    const songCards = document.querySelectorAll(`[data-song-id="${songId}"]`);
    songCards.forEach(card => {
        if (newPlayCount !== null) {
            card.dataset.plays = newPlayCount;
        } else {
            const currentPlays = parseInt(card.dataset.plays) || 0;
            card.dataset.plays = currentPlays + 1;
        }
    });
}

// ===== DOWNLOAD COUNTING =====
function downloadSong(songId, buttonElement = null) {
    console.log(' Downloading song:', songId);
    
    if (buttonElement) {
        buttonElement.disabled = true;
        buttonElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        buttonElement.classList.add('downloading');
    }
    
    // First track the download
    trackSongDownload(songId)
        .then(data => {
            if (data.success) {
                console.log(' Download tracked successfully:', data.download_count);
                updateDownloadCountUI(songId, data.download_count);
                
                // Then proceed with actual download
                const song = window.homePlaylist?.find(s => s.id === songId);
                if (song) {
                    // Use your existing download function
                    if (typeof window.downloadSong === 'function') {
                        window.downloadSong(songId, song.audio, song.title, song.artist);
                    } else {
                        // Fallback download
                        window.open(`/download-song/${songId}/`, '_blank');
                    }
                    showNotification(`Downloading: ${song.title}`, 'success');
                }
            } else {
                console.error(' Download tracking failed:', data.error);
                showNotification('Error tracking download', 'error');
            }
        })
        .catch(error => {
            console.error(' Download tracking error:', error);
            showNotification('Download error occurred', 'error');
        })
        .finally(() => {
            if (buttonElement) {
                setTimeout(() => {
                    buttonElement.disabled = false;
                    buttonElement.innerHTML = '<i class="fas fa-download"></i>';
                    buttonElement.classList.remove('downloading');
                }, 2000);
            }
        });
}

// Download tracking
function trackSongDownload(songId) {
    const song = window.homePlaylist?.find(s => s.id === songId);
    
    return fetch('/api/track-download/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({
            song_id: songId,
            song_title: song?.title || 'Unknown',
            artist_name: song?.artist || 'Unknown',
            timestamp: new Date().toISOString(),
            user_agent: navigator.userAgent
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    });
}

// Download count UI update
function updateDownloadCountUI(songId, newDownloadCount = null) {
    const downloadElements = document.querySelectorAll(`[data-song-id="${songId}"] .downloads, [data-song-id="${songId}"] .download-count`);
    
    downloadElements.forEach(element => {
        if (newDownloadCount !== null) {
            element.textContent = newDownloadCount;
        } else {
            const currentCount = parseInt(element.textContent) || 0;
            element.textContent = currentCount + 1;
        }
        
        element.style.transform = 'scale(1.2)';
        element.style.color = 'var(--success)';
        setTimeout(() => {
            element.style.transform = 'scale(1)';
            element.style.color = '';
        }, 300);
    });
    
    const songCards = document.querySelectorAll(`[data-song-id="${songId}"]`);
    songCards.forEach(card => {
        if (newDownloadCount !== null) {
            card.dataset.downloads = newDownloadCount;
        } else {
            const currentDownloads = parseInt(card.dataset.downloads) || 0;
            card.dataset.downloads = currentDownloads + 1;
        }
    });
}

// ===== LIKE FUNCTIONALITY =====
function likeSong(songId, buttonElement) {
    console.log(' Liking song:', songId);
    
    fetch(`/api/songs/${songId}/like/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        console.log(' Like response:', data);
        if (data.success) {
            const heartIcon = buttonElement.querySelector('i');
            if (data.liked) {
                heartIcon.className = 'fas fa-heart';
                heartIcon.style.color = 'var(--primary)';
                showNotification('Added to liked songs!', 'success');
            } else {
                heartIcon.className = 'far fa-heart';
                heartIcon.style.color = '';
                showNotification('Removed from liked songs', 'info');
            }
        } else {
            showNotification(data.error || 'Error updating like status', 'error');
        }
    })
    .catch(error => {
        console.error(' Like error:', error);
        showNotification('Error updating like status', 'error');
    });
}

// ===== ARTIST FUNCTIONS =====
function followArtist(artistId, button) {
    console.log(' Following artist:', artistId);
    
    {% if user.is_authenticated %}
    fetch(`/api/artists/${artistId}/follow/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        console.log(' Follow response:', data);
        if (data.success) {
            if (data.followed) {
                button.innerHTML = '<i class="fas fa-check"></i> Following';
                button.classList.add('following');
                showNotification('Now following artist!', 'success');
            } else {
                button.innerHTML = '<i class="fas fa-plus"></i> Follow';
                button.classList.remove('following');
                showNotification('Unfollowed artist', 'info');
            }
        } else {
            showNotification(data.error || 'Error following artist', 'error');
        }
    })
    .catch(error => {
        console.error(' Follow error:', error);
        showNotification('Error following artist', 'error');
    });
    {% else %}
    showNotification('Please login to follow artists', 'info');
    {% endif %}
}

function viewArtist(artistId) {
    window.location.href = `/artist/${artistId}/`;
}

// ===== UTILITY FUNCTIONS =====
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function showNotification(message, type = 'info') {
    console.log(' Notification:', message, type);
    
    if (typeof window.showMessage === 'function') {
        window.showMessage(message, type);
    } else {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            background: ${type === 'success' ? '#1db954' : type === 'error' ? '#dc3545' : '#17a2b8'};
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }
}

function setupMobileStats() {
    const statsElements = document.querySelectorAll('.song-stats-below');
    statsElements.forEach(stats => {
        stats.style.display = 'flex';
    });
}

// ===== DEBUGGING FUNCTIONS =====
window.debugPlayCounting = function() {
    console.log('=== PLAY COUNTING DEBUG INFO ===');
    console.log('Home Playlist:', window.homePlaylist);
    console.log('CSRF Token:', getCookie('csrftoken') ? 'Available' : 'Missing');
    console.log('User Authenticated:', {% if user.is_authenticated %}true{% else %}false{% endif %});
    console.log('===============================');
};

// Test play counting
window.testPlayCount = function(songId = 1) {
    console.log(' Testing play count for song:', songId);
    trackSongPlay(songId)
        .then(data => console.log('Test result:', data))
        .catch(error => console.error('Test error:', error));
};

// Make functions globally available
window.playSongFromCard = playSongFromCard;
window.downloadSong = downloadSong;
window.likeSong = likeSong;
window.followArtist = followArtist;
window.startListening = startListening;
window.playYouTubeVideo = playYouTubeVideo;
window.closeVideoModal = closeVideoModal;

console.log(' Sangabiz Enhanced JavaScript loaded successfully!');
</script>
{% endblock %}