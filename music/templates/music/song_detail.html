{% extends 'base.html' %}
{% load static %}

{% block title %}{{ song.title }} - {{ song.artist.name }} | Sangabiz{% endblock %}

{% block content %}
<div class="container">
    <!-- Back Button -->
    <div style="margin-bottom: 20px;">
        <button onclick="window.history.back()" class="nav-btn">
            <i class="fas fa-arrow-left"></i> Back
        </button>
    </div>

    <!-- Song Header -->
    <div style="display: flex; gap: 30px; margin-bottom: 40px; flex-wrap: wrap;">
        <!-- Song Cover -->
        <div style="flex-shrink: 0;">
            {% if song.cover_image %}
                <img src="{{ song.cover_image.url }}" alt="{{ song.title }}" 
                     style="width: 300px; height: 300px; object-fit: cover; border-radius: 10px;">
            {% else %}
                <div style="width: 300px; height: 300px; background: #282828; border-radius: 10px; 
                           display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-music" style="font-size: 80px; color: #535353;"></i>
                </div>
            {% endif %}
        </div>

        <!-- Song Info -->
        <div style="flex: 1; min-width: 300px;">
            <h1 style="font-size: 36px; margin-bottom: 10px; color: white;">{{ song.title }}</h1>
            <p style="font-size: 20px; color: #b3b3b3; margin-bottom: 30px;">
                by {{ song.artist.name }}
            </p>

            <!-- Messages -->
            {% if messages %}
                <div style="margin-bottom: 20px;">
                    {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                    {% endfor %}
                </div>
            {% endif %}

            <!-- Action Buttons -->
            <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 30px;">
                <button class="download-btn" onclick="downloadSong({{ song.id }}, '{{ song.title }}', '{{ song.artist.name }}')">
                    <i class="fas fa-download"></i> Download
                </button>
                
                <button class="quick-action-btn" onclick="playThisSong({{ song.id }})">
                    <i class="fas fa-play"></i> Play
                </button>
                
                <button class="quick-action-btn">
                    <i class="far fa-heart"></i> Like
                </button>
            </div>

            <!-- Song Details -->
            <div style="background: #181818; padding: 20px; border-radius: 8px;">
                <h3 style="margin-bottom: 15px; color: white;">Song Details</h3>
                <div style="display: grid; grid-template-columns: auto 1fr; gap: 10px 20px; color: #b3b3b3;">
                    <strong>Genre:</strong> <span>{{ song.genre.name }}</span>
                    <strong>Duration:</strong> <span>{{ song.duration }}</span>
                    <strong>Uploaded:</strong> <span>{{ song.created_at|date:"M d, Y" }}</span>
                    <strong>Downloads:</strong> <span>{{ song.download_count }}</span>
                    <strong>Plays:</strong> <span>{{ song.play_count }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Related Songs -->
    {% if related_songs %}
    <div>
        <h2 style="margin-bottom: 20px; color: white;">Related Songs</h2>
        <div class="song-list">
            {% for related_song in related_songs %}
            <div class="song-item" onclick="playThisSong({{ related_song.id }})">
                <div class="song-number">{{ forloop.counter }}</div>
                <div class="play-icon">
                    <i class="fas fa-play"></i>
                </div>
                <div class="song-info-small">
                    <div class="song-title">{{ related_song.title }}</div>
                    <div class="song-artist">{{ related_song.artist.name }}</div>
                </div>
                <div class="song-duration">{{ related_song.duration }}</div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<script>
function downloadSong(songId, songTitle, artistName) {
    const downloadUrl = `/download-song/${songId}/`;
    console.log(`Downloading: ${songTitle} by ${artistName}`);
    
    const link = document.createElement('a');
    link.href = downloadUrl;
    link.style.display = 'none';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>
{% endblock %}