{% extends "base.html" %}
{% load static %}

{% block title %}Sign Up - Sangabiz{% endblock %}

{% block content %}
<div class="simple-signup">
    <div class="signup-container">
        <div class="signup-card">
            <div class="signup-header">
                <i class="fas fa-music"></i>
                <h1>Join Sangabiz</h1>
                <p>Create your account to start listening</p>
            </div>

            {% if messages %}
            <div class="messages">
                {% for message in messages %}
                <div class="message {{ message.tags }}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <form method="POST" class="signup-form">
                {% csrf_token %}
                
                <div class="input-group">
                    <input type="text" name="first_name" placeholder="First Name" required 
                           value="{{ request.POST.first_name }}">
                </div>

                <div class="input-group">
                    <input type="text" name="last_name" placeholder="Last Name" required 
                           value="{{ request.POST.last_name }}">
                </div>

                <div class="input-group">
                    <input type="text" name="username" placeholder="Username" required 
                           value="{{ request.POST.username }}">
                </div>

                <div class="input-group">
                    <input type="email" name="email" placeholder="Email Address" required 
                           value="{{ request.POST.email }}">
                </div>

                <div class="artist-option">
                    <label class="artist-checkbox">
                        <input type="checkbox" name="is_artist" id="is_artist" 
                               {% if request.POST.is_artist %}checked{% endif %}>
                        <span class="checkmark"></span>
                        Sign up as an Artist
                    </label>
                    <p class="artist-hint">Upload your music and grow your audience</p>
                </div>

                <div class="artist-fields" id="artist-fields" 
                     style="display: {% if request.POST.is_artist %}block{% else %}none{% endif %};">
                    <div class="input-group">
                        <input type="text" name="artist_name" placeholder="Artist Name" required
                               value="{{ request.POST.artist_name }}">
                    </div>

                    <div class="input-group">
                        <textarea name="bio" placeholder="Tell us about your music...">{{ request.POST.bio }}</textarea>
                    </div>

                    <div class="input-group">
                        <select name="genre">
                            <option value="">Select Genre</option>
                            {% for genre in genres %}
                            <option value="{{ genre.id }}" {% if request.POST.genre == genre.id|stringformat:"i" %}selected{% endif %}>
                                {{ genre.name }}
                            </option>
                            {% empty %}
                            <!-- Fallback if no genres in database -->
                            <option value="1">Pop</option>
                            <option value="2">Rock</option>
                            <option value="3">Hip Hop</option>
                            <option value="4">R&B</option>
                            <option value="5">Electronic</option>
                            <option value="6">Jazz</option>
                            <option value="7">Classical</option>
                            <option value="8">Reggae</option>
                            <option value="9">Country</option>
                            <option value="10">Afrobeat</option>
                            <option value="11">Gospel</option>
                            <option value="12">Other</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="input-group">
                    <input type="password" name="password1" placeholder="Password" required>
                    <small style="color: #a4b0be; margin-top: 5px;">Password must be at least 8 characters long</small>
                </div>

                <div class="input-group">
                    <input type="password" name="password2" placeholder="Confirm Password" required>
                </div>

                <div class="terms">
                    <label>
                        <input type="checkbox" name="terms" required 
                               {% if request.POST.terms %}checked{% endif %}>
                        I agree to the Terms of Service
                    </label>
                </div>

                <button type="submit" class="signup-btn">
                    Create Account
                </button>
            </form>

            <div class="login-link">
                Already have an account? <a href="{% url 'login' %}">Sign in</a>
            </div>
        </div>
    </div>
</div>

<style>
.simple-signup {
    min-height: 100vh;
    background: linear-gradient(135deg, #1e1e2f, #2d1b69);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.signup-container {
    width: 100%;
    max-width: 400px;
}

.signup-card {
    background: rgba(255, 255, 255, 0.05);
    padding: 40px 30px;
    border-radius: 15px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

.signup-header {
    text-align: center;
    margin-bottom: 30px;
}

.signup-header i {
    font-size: 3rem;
    color: #6c5ce7;
    margin-bottom: 15px;
}

.signup-header h1 {
    color: white;
    font-size: 24px;
    margin-bottom: 8px;
}

.signup-header p {
    color: #a4b0be;
    font-size: 14px;
}

.messages {
    margin-bottom: 20px;
}

.message {
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 10px;
    font-size: 14px;
}

.message.error {
    background: rgba(231, 76, 60, 0.2);
    color: #e74c3c;
    border: 1px solid #e74c3c;
}

.message.success {
    background: rgba(46, 204, 113, 0.2);
    color: #2ecc71;
    border: 1px solid #2ecc71;
}

.signup-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.input-group {
    display: flex;
    flex-direction: column;
}

.input-group input,
.input-group textarea,
.input-group select {
    padding: 12px 15px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    color: white;
    font-size: 14px;
    transition: all 0.3s ease;
    width: 100%;
    box-sizing: border-box;
}

.input-group input::placeholder,
.input-group textarea::placeholder {
    color: rgba(255, 255, 255, 0.6);
}

.input-group input:focus,
.input-group textarea:focus,
.input-group select:focus {
    outline: none;
    border-color: #6c5ce7;
    background: rgba(255, 255, 255, 0.15);
}

.input-group textarea {
    resize: vertical;
    min-height: 80px;
    font-family: inherit;
}

.artist-option {
    margin: 10px 0;
    padding: 15px;
    background: rgba(108, 92, 231, 0.1);
    border-radius: 8px;
    border: 1px solid rgba(108, 92, 231, 0.3);
}

.artist-checkbox {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    color: white;
    font-weight: 600;
}

.artist-checkbox input[type="checkbox"] {
    opacity: 0;
    position: absolute;
    width: 0;
    height: 0;
}

.artist-checkbox .checkmark {
    width: 20px;
    height: 20px;
    border: 2px solid #a4b0be;
    border-radius: 4px;
    position: relative;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.artist-checkbox input[type="checkbox"]:checked + .checkmark {
    background: #6c5ce7;
    border-color: #6c5ce7;
}

.artist-checkbox input[type="checkbox"]:checked + .checkmark::after {
    content: 'âœ“';
    color: white;
    font-size: 14px;
    font-weight: bold;
}

.artist-hint {
    font-size: 12px;
    color: #a4b0be;
    margin: 5px 0 0 30px;
}

.artist-fields {
    margin: 10px 0;
    padding: 20px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border-left: 3px solid #6c5ce7;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.terms {
    margin: 10px 0;
}

.terms label {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #a4b0be;
    font-size: 14px;
    cursor: pointer;
}

.terms input[type="checkbox"] {
    width: 16px;
    height: 16px;
}

.signup-btn {
    padding: 15px;
    background: #6c5ce7;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 10px;
}

.signup-btn:hover {
    background: #5649c0;
    transform: translateY(-2px);
}

.signup-btn:active {
    transform: translateY(0);
}

.login-link {
    text-align: center;
    margin-top: 20px;
    color: #a4b0be;
    font-size: 14px;
}

.login-link a {
    color: #6c5ce7;
    text-decoration: none;
    font-weight: 600;
}

.login-link a:hover {
    color: #fd79a8;
    text-decoration: underline;
}

@media (max-width: 480px) {
    .signup-card {
        padding: 30px 20px;
    }
    
    .simple-signup {
        padding: 10px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const artistToggle = document.getElementById('is_artist');
    const artistFields = document.getElementById('artist-fields');
    
    function toggleArtistFields() {
        if (artistToggle && artistFields) {
            const isChecked = artistToggle.checked;
            artistFields.style.display = isChecked ? 'block' : 'none';
            
            // Make artist name required if artist is selected
            const artistNameInput = document.querySelector('input[name="artist_name"]');
            if (artistNameInput) {
                artistNameInput.required = isChecked;
            }
        }
    }
    
    if (artistToggle) {
        artistToggle.addEventListener('change', toggleArtistFields);
        // Initialize on page load
        toggleArtistFields();
    }
});
</script>
{% endblock %}